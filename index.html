<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCC Dash v39 - Visualizer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&family=Syne+Mono&display=swap');
        :root { --brand-red: #FF8981; --brand-yellow: #fff1ce; }
        body { background-color: #0a0a0a; color: #fffefb; font-family: 'Open Sans', sans-serif; overflow-x: hidden; }
        .brand-accent { font-family: 'Syne Mono', monospace; color: var(--brand-yellow); }
        .bento-card { background: #1c1c1c; border: 1px solid #2a2a2a; border-radius: 1.25rem; padding: 1.5rem; display: flex; flex-direction: column; position: relative; transition: all 0.5s ease; z-index: 10; }
        
        /* GLOBAL GLOW EFFECT */
        #screen-glow { position: fixed; inset: 0; pointer-events: none; transition: box-shadow 1s ease; z-index: 5; }
        .glow-work { box-shadow: inset 0 0 100px rgba(255, 137, 129, 0.25); }
        .glow-break { box-shadow: inset 0 0 100px rgba(255, 241, 206, 0.2); }

        /* AUDIO VISUALIZER */
        #audio-viz { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; pointer-events: none; z-index: 50; opacity: 0; transition: opacity 1s ease; }
        .viz-active { opacity: 1 !important; }

        .dark-cal { filter: invert(92%) hue-rotate(180deg) brightness(105%) contrast(100%); background: #ffffff; }
        .accent-bg { background-color: var(--brand-yellow); color: #0a0a0a; }
        .scroller { overflow-y: auto; max-height: 250px; }
        .scroller::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-thumb { background: #333333; border-radius: 10px; }
        .day-sq { width: 10px; height: 10px; border-radius: 2px; background: #2a2a2a; transition: all 0.3s ease; }
        .day-sq.active { background: var(--brand-yellow); box-shadow: 0 0 8px rgba(255, 241, 206, 0.4); }
        .section-title { font-size: 14px; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 700; }
        #video-controls { background: rgba(10, 10, 10, 0.9); backdrop-filter: blur(8px); display: none; }
        
        @keyframes subtlePulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        .pomo-running { animation: subtlePulse 3s infinite; }
    </style>
</head>
<body class="p-4 min-h-screen pb-20"> <div id="screen-glow"></div>
    
    <canvas id="audio-viz"></canvas>

    <div class="w-full max-w-[1000px] mx-auto flex flex-col gap-4">
        
        <div id="header-card" class="bento-card text-center gap-2 border-[#fff1ce]/10">
            <div class="flex flex-col md:flex-row justify-between items-center w-full px-2 gap-4">
                <div class="flex-1 text-left">
                    <p class="brand-accent text-3xl font-bold uppercase tracking-tighter">Good Evening, Rich</p>
                    <p id="date" class="brand-accent text-xs opacity-60 uppercase tracking-widest mt-1">Date Loading...</p>
                </div>
                <div class="flex-none"><h1 id="clock" class="brand-accent text-7xl font-bold tracking-tighter leading-none">00:00</h1></div>
                <div class="flex-1 text-right">
                    <div class="flex items-center justify-end gap-2 text-[#fff1ce]">
                        <i data-lucide="cloud-moon" class="w-8 h-8"></i>
                        <span class="brand-accent text-3xl font-bold">48°F</span>
                    </div>
                    <p class="brand-accent text-xs opacity-60 uppercase tracking-widest mt-1">Clear · Fort Collins</p>
                </div>
            </div>
        </div>

        <div id="pomo-card" class="bento-card flex-row items-center justify-between py-4 px-8 border-white/5 hover:border-white/10 transition">
            <div class="flex items-center gap-4">
                <div id="pomo-status-icon" class="p-2 rounded-full bg-white/5 text-[#fff1ce]">
                    <i data-lucide="timer" class="w-6 h-6"></i>
                </div>
                <div>
                    <h4 id="pomo-label" class="brand-accent text-sm font-bold uppercase tracking-widest opacity-40">Ready to Focus</h4>
                    <p id="pomo-timer-display" class="brand-accent text-2xl font-bold">50:00</p>
                </div>
            </div>
            <button id="pomo-main-btn" onclick="togglePomo()" class="accent-bg px-10 py-3 rounded-full font-bold uppercase text-sm tracking-widest hover:scale-105 transition active:scale-95 flex items-center gap-2">
                <i data-lucide="play" class="w-4 h-4"></i> <span>Start Cycle</span>
            </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bento-card border-[#FF8981]/20">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-[#FF8981] section-title">Gmail</h3>
                    <i data-lucide="mail" class="w-5 h-5 text-[#FF8981]"></i>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <a href="https://mail.google.com/mail/u/1/#search/label%3Aunread" target="_blank" class="bg-[#0a0a0a] border border-[#2a2a2a] p-3 rounded-xl flex items-center justify-between group hover:border-[#FF8981]/50 transition">
                        <span class="text-[10px] font-bold uppercase tracking-widest opacity-80">Unread</span>
                        <i data-lucide="mail-warning" class="w-4 h-4 text-[#FF8981]"></i>
                    </a>
                    <a href="https://mail.google.com/mail/u/1/#compose" target="_blank" class="accent-bg p-3 rounded-xl flex items-center justify-between hover:opacity-90 transition">
                        <span class="text-[10px] font-bold uppercase tracking-widest">Compose</span>
                        <i data-lucide="pen-tool" class="w-4 h-4"></i>
                    </a>
                </div>
            </div>
            <div class="bento-card border-white/5">
                <div class="grid grid-cols-4 gap-2 h-full">
                    <a href="slack://open" class="flex flex-col items-center justify-center gap-2 bg-[#0a0a0a] rounded-xl hover:bg-[#2a2a2a] border border-[#2a2a2a] transition">
                        <i data-lucide="message-circle" class="w-5 h-5 text-[#fff1ce]"></i>
                    </a>
                    <a href="https://jitter.video" target="_blank" class="flex flex-col items-center justify-center gap-2 bg-[#0a0a0a] rounded-xl hover:bg-[#2a2a2a] border border-[#2a2a2a] transition">
                        <i data-lucide="video" class="w-5 h-5 text-[#fff1ce]"></i>
                    </a>
                    <a href="https://linkedin.com" target="_blank" class="flex flex-col items-center justify-center gap-2 bg-[#0a0a0a] rounded-xl hover:bg-[#2a2a2a] border border-[#2a2a2a] transition">
                        <i data-lucide="linkedin" class="w-5 h-5 text-[#fff1ce]"></i>
                    </a>
                    <a href="https://gemini.google.com/app" target="_blank" class="flex flex-col items-center justify-center gap-2 bg-[#fff1ce]/5 rounded-xl hover:bg-[#fff1ce]/20 border border-[#fff1ce]/20 transition">
                        <i data-lucide="sparkles" class="w-5 h-5 text-[#fff1ce]"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="bento-card p-0 overflow-hidden relative aspect-video group">
            <div id="focus-video" class="absolute inset-0 w-full h-full"></div>
            <button onclick="toggleVideoSettings()" class="absolute top-4 right-4 z-20 bg-black/50 p-2 rounded-full opacity-0 group-hover:opacity-100 transition"><i data-lucide="settings" class="w-4 h-4 text-white"></i></button>
            <div id="video-controls" class="absolute inset-0 z-30 flex flex-col items-center justify-center p-8 text-center">
                <input type="text" id="videoUrlInput" placeholder="YouTube Link..." class="bg-black border border-[#2a2a2a] rounded-xl px-4 py-2 text-white mb-2">
                <button onclick="updateVideo()" class="accent-bg px-4 py-2 rounded-xl font-bold text-xs uppercase">Update</button>
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bento-card">
                <h3 class="text-[#fff1ce] section-title mb-4">Tasks</h3>
                <div class="flex gap-2 mb-4">
                    <input type="text" id="taskInput" placeholder="..." class="flex-1 bg-black border border-white/10 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-[#fff1ce]">
                    <button onclick="addTask()" class="accent-bg px-4 rounded-xl font-bold">+</button>
                </div>
                <div id="taskList" class="space-y-2 scroller"></div>
            </div>
            <div class="bento-card">
                <h3 class="text-[#fff1ce] section-title mb-4">Habits</h3>
                <div id="habitList" class="space-y-4 scroller"></div>
                <div class="flex gap-2 mt-4">
                    <input type="text" id="habitInput" placeholder="..." class="flex-1 bg-black border border-white/10 rounded-xl px-4 py-2 text-sm focus:outline-none focus:border-[#fff1ce]">
                    <button onclick="addHabit()" class="accent-bg px-4 rounded-xl font-bold">+</button>
                </div>
            </div>
        </div>

        <div class="bento-card p-0 overflow-hidden h-[400px]">
            <iframe src="https://calendar.google.com/calendar/embed?src=mgmt%40radcreative.work&ctz=America%2FDenver&mode=AGENDA&showTitle=0&showNav=1&showPrint=0&showTabs=0&showCalendars=0" class="dark-cal" width="100%" height="100%" frameborder="0"></iframe>
        </div>
    </div>

    <script>
        // --- VISUALIZER LOGIC ---
        const canvas = document.getElementById('audio-viz');
        const ctx = canvas.getContext('2d');
        let vizColor = '#FF8981'; // Default Red
        let vizSpeed = 0.02;

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = 100; // Height of wave area
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let waveOffset = 0;
        function animateViz() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (isRunning) {
                waveOffset += vizSpeed;
                
                // Layer 1
                drawWave(canvas.height / 2, 20, 0.01, waveOffset, vizColor, 0.5);
                // Layer 2 (Offset)
                drawWave(canvas.height / 2 + 5, 15, 0.02, waveOffset * 1.5, vizColor, 0.3);
                // Layer 3 (High Freq)
                drawWave(canvas.height / 2 - 5, 10, 0.03, waveOffset * 2, vizColor, 0.2);
            }
            
            requestAnimationFrame(animateViz);
        }

        function drawWave(yBase, amplitude, frequency, offset, color, alpha) {
            ctx.beginPath();
            ctx.moveTo(0, yBase);
            for (let x = 0; x < canvas.width; x++) {
                const y = yBase + Math.sin(x * frequency + offset) * amplitude * Math.sin(x * 0.005 + offset); 
                ctx.lineTo(x, y);
            }
            // Close path to bottom for fill
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.fillStyle = hexToRgba(color, alpha);
            ctx.fill();
        }

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        animateViz(); // Start Loop

        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playChime(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            if (type === 'work') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, audioCtx.currentTime); // High A
                osc.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.5);
            } else {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, audioCtx.currentTime); // Middle A
                osc.frequency.exponentialRampToValueAtTime(660, audioCtx.currentTime + 0.5);
            }
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.8);
        }

        // --- POMODORO LOGIC ---
        let pomoInterval;
        let pomoTime = 50 * 60;
        let isWorking = true;
        let isRunning = false;

        function togglePomo() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const btn = document.getElementById('pomo-main-btn');
            const card = document.getElementById('pomo-card');
            const glow = document.getElementById('screen-glow');
            const viz = document.getElementById('audio-viz');

            if (isRunning) {
                clearInterval(pomoInterval);
                isRunning = false;
                btn.innerHTML = `<i data-lucide="play" class="w-4 h-4"></i> <span>Resume</span>`;
                card.classList.remove('pomo-running');
                glow.className = '';
                viz.classList.remove('viz-active'); // Hide viz
            } else {
                isRunning = true;
                btn.innerHTML = `<i data-lucide="pause" class="w-4 h-4"></i> <span>Pause</span>`;
                card.classList.add('pomo-running');
                viz.classList.add('viz-active'); // Show viz
                pomoInterval = setInterval(() => {
                    pomoTime--;
                    updatePomoDisplay();
                    if (pomoTime <= 0) switchPomoMode();
                }, 1000);
            }
            lucide.createIcons();
            updatePomoDisplay();
        }

        function switchPomoMode() {
            isWorking = !isWorking;
            pomoTime = isWorking ? 50 * 60 : 10 * 60;
            playChime(isWorking ? 'work' : 'break');
            
            // Update Visualizer Colors
            vizColor = isWorking ? '#FF8981' : '#fff1ce';
            vizSpeed = isWorking ? 0.03 : 0.01; // Slower on break

            updatePomoDisplay();
        }

        function updatePomoDisplay() {
            const timerTxt = document.getElementById('pomo-timer-display');
            const labelTxt = document.getElementById('pomo-label');
            const glow = document.getElementById('screen-glow');
            const card = document.getElementById('pomo-card');
            
            const m = Math.floor(pomoTime / 60).toString().padStart(2, '0');
            const s = (pomoTime % 60).toString().padStart(2, '0');
            timerTxt.innerText = `${m}:${s}`;
            
            if (isRunning) {
                labelTxt.innerText = isWorking ? 'Deep Work Phase' : 'Recharge Phase';
                labelTxt.style.opacity = "1";
                labelTxt.style.color = isWorking ? "var(--brand-red)" : "var(--brand-yellow)";
                glow.className = isWorking ? 'glow-work' : 'glow-break';
                card.style.borderColor = isWorking ? "var(--brand-red)" : "var(--brand-yellow)";
            }
        }

        // --- CORE DATA & SETUP ---
        let tasks = JSON.parse(localStorage.getItem('rad_tasks')) || [];
        let habits = JSON.parse(localStorage.getItem('rad_habits')) || [];
        let player;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('focus-video', {
                height: '100%', width: '100%', videoId: 'DUzQadS3aJ0',
                playerVars: { 'autoplay': 1, 'mute': 1, 'controls': 1, 'modestbranding': 1, 'playsinline': 1 },
                events: { 'onReady': (e) => { e.target.mute(); e.target.setVolume(10); e.target.playVideo(); }}
            });
        }

        function updateUI() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
            document.getElementById('date').innerText = now.toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
            cleanOldTasks();
        }

        function cleanOldTasks() {
            const twelveHoursAgo = Date.now() - (12 * 60 * 60 * 1000);
            tasks = tasks.filter(t => !t.done || !t.completedAt || t.completedAt > twelveHoursAgo);
            render();
        }

        function render() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskList').innerHTML = tasks.map((t, i) => `
                <div class="flex justify-between items-center bg-black/40 p-3 rounded-xl border border-white/5 group">
                    <span class="text-sm cursor-pointer ${t.done ? 'text-zinc-600 line-through' : 'text-[#fffefb]'}" onclick="toggleT(${i})">${t.text}</span>
                    <button onclick="delT(${i})" class="opacity-0 group-hover:opacity-100 text-zinc-800 hover:text-red-500 transition"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>`).join('');

            document.getElementById('habitList').innerHTML = habits.map((h, i) => {
                let hMap = '';
                for(let d=6; d>=0; d--) {
                    const date = new Date(); date.setDate(date.getDate() - d);
                    const dStr = date.toISOString().split('T')[0];
                    const act = h.history.includes(dStr) ? 'active' : '';
                    hMap += `<div class="day-sq ${act}"></div>`;
                }
                return `<div class="bg-black/40 p-3 rounded-xl border border-white/5 group">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs ${h.history.includes(today) ? 'text-zinc-600' : 'text-[#fffefb]'}">${h.text}</span>
                        <div class="flex gap-2">
                            <button onclick="toggleH(${i})" class="p-1 rounded-lg ${h.history.includes(today) ? 'bg-[#fff1ce] text-[#0a0a0a]' : 'bg-[#2a2a2a] text-[#fff1ce]'}"><i data-lucide="check" class="w-3 h-3"></i></button>
                            <button onclick="delH(${i})" class="opacity-0 group-hover:opacity-100 text-zinc-800 hover:text-red-500"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                        </div>
                    </div><div class="flex gap-2">${hMap}</div></div>`;
            }).join('');
            
            localStorage.setItem('rad_tasks', JSON.stringify(tasks));
            localStorage.setItem('rad_habits', JSON.stringify(habits));
            if (window.lucide) lucide.createIcons();
        }

        function addTask() { 
            const inp = document.getElementById('taskInput'); 
            if(inp.value.trim()){ tasks.push({text: inp.value.trim(), done: false, completedAt: null}); inp.value=''; render(); } 
        }
        function toggleT(i) { tasks[i].done = !tasks[i].done; tasks[i].completedAt = tasks[i].done ? Date.now() : null; render(); }
        function delT(i) { tasks.splice(i,1); render(); }
        function addHabit() { const inp = document.getElementById('habitInput'); if(inp.value.trim()){ habits.push({text: inp.value.trim(), history: []}); inp.value=''; render(); } }
        function toggleH(i) { 
            const t = new Date().toISOString().split('T')[0]; 
            const idx = habits[i].history.indexOf(t); 
            if(idx > -1) habits[i].history.splice(idx,1); 
            else habits[i].history.push(t); 
            render(); 
        }
        function delH(i) { habits.splice(i,1); render(); }
        function toggleVideoSettings() {
            const p = document.getElementById('video-controls'); p.style.display = p.style.display === 'flex' ? 'none' : 'flex';
        }
        function updateVideo() {
            const val = document.getElementById('videoUrlInput').value;
            let id = val;
            if (val.includes('v=')) id = val.split('v=')[1].split('&')[0];
            else if (val.includes('be/')) id = val.split('be/')[1].split('?')[0];
            if (id && player) {
                player.loadVideoById(id);
                player.setVolume(10);
                toggleVideoSettings();
            }
        }
        document.getElementById('taskInput').addEventListener('keypress', (e) => e.key === 'Enter' && addTask());
        document.getElementById('habitInput').addEventListener('keypress', (e) => e.key === 'Enter' && addHabit());

        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.head.appendChild(tag);

        setInterval(updateUI, 60000); 
        updateUI(); 
        const boot = () => { if (window.lucide) { render(); } else { setTimeout(boot, 50); } };
        boot();
    </script>
</body>
</html>
